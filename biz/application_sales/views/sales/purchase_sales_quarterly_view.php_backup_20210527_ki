<?php
	include $this->input->server('DOCUMENT_ROOT')."/include/base.php";
	include $this->input->server('DOCUMENT_ROOT')."/include/sales_top.php";
?>
<link rel="stylesheet" href="/misc/css/dashboard.css">
<script type="text/javascript" src="/misc/js/excel/jquery.table2excel.js"></script>
<link href="https://fonts.googleapis.com/css?family=Noto+Sans+KR" rel="stylesheet">
<style media="screen">

  .dash_tbl1-1{
    margin:20px;
    display:grid;
  }

  .contents_tbl{
    width: 95%;
    border-color:black;
    border-style:solid;
    border-width:1px;
    text-align:center;
  }

  .contents_tbl th{
    font-size: 16px;
  }

  .parents_div{
  	height: 100%;
		width: 100%;
    text-align: center;
		/*inline-block의 장점은 폰트의 성질도 포함되고 있어서 text-align으로 정렬을 쉽게 할수가 있다.*/
    /* font-size: 0;  */
		/*양 옆쪽, 밑에 4px정도 여백을 없에주는 방법*/
		/* overflow-y:scroll; */
  }

  .child_div{
		height: 30%;
		/* width: 53%; */
		width: 49%;
    display: inline-block; /*이부분에 성질을 inline-block로 바꿔줘서 가로배치를 해줬다.*/
    vertical-align: top; /*밑에 4px 여백을 없에는것*/
		margin-bottom: 10px;
		margin-right:1%;
		text-align:center;
		position:static;
  }
  .child_div2{
		height: 30%;
		/* width: 43%; */
		width: 46%;
    display: inline-block; /*이부분에 성질을 inline-block로 바꿔줘서 가로배치를 해줬다.*/
    vertical-align: top; /*밑에 4px 여백을 없에는것*/
		margin-bottom: 10px;
		margin-left:1%;
		text-align:center;
  }

	.table_border{
		border: black solid 1px;
	}

	.t_b_border{
		border-bottom-width: 1px;
		border-bottom-style: solid;
		border-bottom-color: #d7d7d7;
	}
</style>
<script type="text/javascript">
	$(document).ready(function () {

	  quarter_change();
	});

	function quarter_change(){
		$('.excel_table').html(''); //엑셀 출력용 테이블을 비워놓기(분기를 바꿀 때마다 테이블이 중첩되지 않도록)
		excel_table(); //엑셀 출력용 테이블 먼저 생성(먼저 생성해야 분기,월 등의 내용이 누락되지 않고 엑셀 테이블에 출력된다.)

		// alert(1);
		var dept = $('#dept').val();
		var q_val = $('#quarter_select').val();
		var y_val = $('#year_select').val();
		$('td[name=quarter_rate_0_0_0]').text(q_val+'분기');
		// $('#sales_quarter_rate_0_0_0').text(q_val+'분기');

		var month_val = q_val*3;
		for(q = 3; q > 0; q--){
			$('td[name=quarter_rate_'+q+'_0_0]').text(month_val+'월');
			// $('#sales_quarter_rate_'+q+'_0_0').text(month_val+'월');
			month_val--;
		} //for q

		$.ajax({
			type: "POST",
			dataType : "json",
			url: "<?php echo site_url();?>/sales/purchase_sales/quarterly_purchase_sales",
			data: {
				dept: dept,
				year: y_val,
				quarter: q_val
			},
			success: function(result){
				for(i = 0; i < 4; i++){
					$('td[name=quarter_rate_'+i+'_0_1], td[name=quarter_rate_'+i+'_0_5], td[name=quarter_rate_'+i+'_0_7]').text('구분');
					$('td[name=quarter_rate_'+i+'_0_2]').text('공급가액');
					$('td[name=quarter_rate_'+i+'_0_3]').text('세액');
					$('td[name=quarter_rate_'+i+'_0_4]').text('합계');
					$('td[name=quarter_rate_'+i+'_0_6], td[name=quarter_rate_'+i+'_0_8]').html('국세청<br>전송건수'); //text()는 개행이 안먹히므로 html로 태그를 줌
					$('td[name=quarter_rate_'+i+'_0_1], td[name=quarter_rate_'+i+'_0_2], td[name=quarter_rate_'+i+'_0_3], td[name=quarter_rate_'+i+'_0_4], td[name=quarter_rate_'+i+'_0_5], td[name=quarter_rate_'+i+'_0_6], td[name=quarter_rate_'+i+'_0_7], td[name=quarter_rate_'+i+'_0_8]').css('font-weight', 'bold');
					$('td[name=quarter_rate_'+i+'_0_6], td[name=quarter_rate_'+i+'_0_8]').css('font-size', '1px');

					for(j = 1; j < 6; j++){
						if(j != 5){
							for(q = 0; q < 2; q++){
								var standard = $('td[name=quarter_rate_'+i+'_'+j+'_1]').eq(q).attr('id');
								var split = standard.split('_')[0];

								if(j == 1){
									if(split == 'purchase'){
										var text_val = '상품매출';
									}else if(split == 'sales'){
										var text_val = '상품매입';
									}
									var text_val2 = '전자계산서';
								}else if(j == 2){
									if(split == 'purchase'){
										var text_val = '용역매출';
									}else if(split == 'sales'){
										var text_val = '용역매입';
									}
									var text_val2 = '종이계산서';
								}else if(j == 3){
									if(split == 'purchase'){
										var text_val = '조달매출';
									}else if(split == 'sales'){
										var text_val = '조달매입';
									}
									var text_val2 = '';
								}else if(j == 4){
									var text_val = '운영비';
									var text_val2 = '';
								}
								$('#'+split+'_quarter_rate_'+i+'_'+j+'_1, #'+split+'_quarter_rate_'+i+'_'+j+'_5').text(text_val);
								$('#'+split+'_quarter_rate_'+i+'_'+j+'_7').text(text_val2);
								$('#'+split+'_quarter_rate_'+i+'_'+j+'_1, #'+split+'_quarter_rate_'+i+'_'+j+'_5, #'+split+'_quarter_rate_'+i+'_'+j+'_7').css('font-size', '2px');

								// excel_tabl
								$('#'+split+'_quarter_rate_'+i+'_'+j+'_1__2, #'+split+'_quarter_rate_'+i+'_'+j+'_5__2').text(text_val);
								$('#'+split+'_quarter_rate_'+i+'_'+j+'_7__2').text(text_val2);
								$('#'+split+'_quarter_rate_'+i+'_'+j+'_1__2, #'+split+'_quarter_rate_'+i+'_'+j+'_5__2, #'+split+'_quarter_rate_'+i+'_'+j+'_7__2').css('font-size', '2px');
							} //for q
						}else{
							for(p = 0; p < 2; p++){
								var standard = $('td[name=quarter_rate_'+i+'_5_1]').eq(p).attr('id');
								var split = standard.split('_')[0];
								if(split == 'purchase'){
									var text_val = '매출액';
								}else if(split == 'sales'){
									var text_val = '매입액';
								}
								$('#'+split+'_quarter_rate_'+i+'_5_1').text(text_val);
								$('#'+split+'_quarter_rate_'+i+'_5_1').css('font-size', '2px');

								// excel_table
								$('#'+split+'_quarter_rate_'+i+'_5_1__2').text(text_val);
								$('#'+split+'_quarter_rate_'+i+'_5_1__2').css('font-size', '2px');
							} //for p
						}
					} //for j

					//공급가액,세액,합계,국세청전송건수
					if(i>0){
						k = i-1;


						for(f = 0; f < 2; f++){
							var standard2 = $('td[name=quarter_rate_'+i+'_5_1]').eq(f).attr('id');
							var split2 = standard2.split('_')[0];

							for(z = 1; z < 5; z++){
								if(z == 1){ //상품
									var column_name = 'product';
								}else if(z == 2){ //용역
									var column_name = 'service';
								}else if(z == 3){ //조달
									var column_name = 'support';
								}else if(z == 4){ //운영
									var column_name = 'operation';
								}
								var column_bill = result['result' + z][k][split2 + '_' + column_name + '_bill'];
								if(column_bill == null){
									var column_bill = '-';
								}
								var column_tax = result['result' + z][k][split2 + '_' + column_name + '_tax'];
								if(column_tax == null){
									var column_tax = '-';
								}
								var column_total = result['result' + z][k][split2 + '_' + column_name + '_total'];
								if(column_total == null){
									var column_total = '-';
								}
								var column_count = result['result' + z][k][split2 + '_' + column_name + '_count'];
								if(column_count == null){
									var column_count = '-';
								}
								$('#'+split2+'_quarter_rate_'+i+'_'+z+'_2').text(commaStr(column_bill)).css('text-align','right');
								$('#'+split2+'_quarter_rate_'+i+'_'+z+'_3').text(commaStr(column_tax)).css('text-align','right');
								$('#'+split2+'_quarter_rate_'+i+'_'+z+'_4').text(commaStr(column_total)).css('text-align','right');
								$('#'+split2+'_quarter_rate_'+i+'_'+z+'_6').text(column_count);

								// excel_table
								$('#'+split2+'_quarter_rate_'+i+'_'+z+'_2__2').text(commaStr(column_bill)).css('text-align','right');
								$('#'+split2+'_quarter_rate_'+i+'_'+z+'_3__2').text(commaStr(column_tax)).css('text-align','right');
								$('#'+split2+'_quarter_rate_'+i+'_'+z+'_4__2').text(commaStr(column_total)).css('text-align','right');
								$('#'+split2+'_quarter_rate_'+i+'_'+z+'_6__2').text(column_count);
								if(z == 4){ //운영비
									var column_electronic_bill_type = result['result' + z][k][split2 + '_' + column_name + '_electronic_bill_type'];
									if(column_electronic_bill_type == null){
										var column_electronic_bill_type = '-';
									}
									var column_paper_bill_type = result['result' + z][k][split2 + '_' + column_name + '_paper_bill_type'];
									if(column_paper_bill_type == null){
										var column_paper_bill_type = '-';
									}
									$('#'+split2+'_quarter_rate_'+i+'_1_8').text(column_electronic_bill_type);
									$('#'+split2+'_quarter_rate_'+i+'_2_8').text(column_paper_bill_type);

									// excel_table
									$('#'+split2+'_quarter_rate_'+i+'_1_8__2').text(column_electronic_bill_type);
									$('#'+split2+'_quarter_rate_'+i+'_2_8__2').text(column_paper_bill_type);
								}
							} //for z

						} //for f

					}

				} //for i

				//분기별 합산
				for(t = 0; t < 2; t++){
					for(r = 1; r < 5; r++){
						for(h = 2; h < 9; h++){
							if(h == 5 || h == 7 || (h == 8 && r > 2)){
								continue;
							}else{

								var standard3 = $('td[name=quarter_rate_0_'+r+'_'+h+']').eq(t).attr('id');
								if(standard3 == undefined){ //purchase는 h=8 즉 가로 8번째 칸이 없으므로 undefined가 뜬다. 그래서 undefined이면 패스시킨다.
									continue;
								}
								var split3 = standard3.split('_')[0];
								var plus_val = 0;
								for(g = 1; g < 4; g++){
									var text_val = $('#'+split3+'_quarter_rate_'+g+'_'+r+'_'+h).text();
									if(text_val == '-' || text_val == ''){
										text_val = 0;
									}
									plus_val += deCommaStr(text_val);
								} //for g
								if(h == 6 || h == 8){
									$('#'+split3+'_quarter_rate_0_'+r+'_'+h).text(commaStr(plus_val));

									// excel_table
									$('#'+split3+'_quarter_rate_0_'+r+'_'+h+'__2').text(commaStr(plus_val));
								}else{
									$('#'+split3+'_quarter_rate_0_'+r+'_'+h).text(commaStr(plus_val)).css('text-align','right');

									// excel_table
									$('#'+split3+'_quarter_rate_0_'+r+'_'+h+'__2').text(commaStr(plus_val)).css('text-align','right');
								}

							}
						} //for h
					} //for r
				} //for t

				//매입액 매출액 합산
				for(w = 0; w < 2; w++){
					for(b = 0; b < 4; b++){
						for(d = 2; d < 5; d++){
							var standard4 = $('td[name=quarter_rate_'+b+'_5_'+d+']').eq(w).attr('id');
							var split4 = standard4.split('_')[0];
							var plus_val2 = 0;
							for(a = 1; a < 5; a++){
								var text_val2 = $('#'+split4+'_quarter_rate_'+b+'_'+a+'_'+d).text();
								if(text_val2 == '-' || text_val2 == ''){
									text_val2 = 0;
								}
								plus_val2 += deCommaStr(text_val2);
							} //for a
							$('#'+split4+'_quarter_rate_'+b+'_5_'+d).text(commaStr(plus_val2)).css({
								'text-align': 'right',
								'font-weight': 'bold'
							});

							// excel_table
							$('#'+split4+'_quarter_rate_'+b+'_5_'+d+'__2').text(commaStr(plus_val2)).css({
								'text-align': 'right',
								'font-weight': 'bold'
							});
						} //for d
					} //for b
				} //for w

			} //success
		}); //ajax

	}

	// 금액 부분 콤마 추가
	function commaStr(n) {
	  var reg = /(^[+-]?\d+)(\d{3})/;
	  n += "";

	  while (reg.test(n))
	    n = n.replace(reg, "$1" + "," + "$2");
	  return n;
	}

	// 금액 부분 콤마 제거
	function deCommaStr(comma_num) { //콤마가 붙은 숫자값을 파라미터로 받아오기
		var text = comma_num.toString().replace(/,/g, ""); //값을 문자열로 변경해서 replace로 콤마제거(문자열만 replace가능)
		var num = Number(text); //문자열을 숫자로 변경
		return num;
	}

</script>
<body>
  <?php
    include $this->input->server('DOCUMENT_ROOT')."/include/sales_header.php";
  ?>
	<div align="center">
		<div class="dash1-1">
			<table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0" class="dash_tbl1-1">
				<tbody>
					<tr height="5%">
						<td class="dash_title">
							<img src="<?php echo $misc;?>img/dashboard/title_quarterly_purchase_sales.png"/>
						</td>
					</tr>
					<tr height="30px">
					</tr>
		<!-- 검색창 시작 -->
					<tr height="10%">
						<td align="left" valign="bottom">
							<table width="100%" cellspacing="0" cellpadding="0" >
								<tr>
									<td width="2%"></td>
									<td>
										<select class="select7" id="dept" onchange="quarter_change();" style="width:150px;">
											<option value="IT">두리안정보기술</option>
											<option value="DBS">두리안정보기술 부산지점</option>
											<option value="ICT">두리안정보통신기술</option>
											<option value="MG">더망고</option>
										</select>
										<select class="select7" id="year_select" onchange="quarter_change();">
										<?php
											$year = date("Y");
											for($i=2019;$i<$year+3;$i++){
											?>
												<option value="<?php echo $i; ?>" <?php if($year == $i){echo 'selected';} ?>><?php echo $i; ?></option>
										<?php } ?>
										</select>
										<select class="select7" id="quarter_select" onchange="quarter_change();">
											<option value="1" <?php if(date("m") < 4){echo 'selected';} ?>>1분기</option>
											<option value="2" <?php if(date("m") > 3 && date("m") < 7){echo 'selected';} ?>>2분기</option>
											<option value="3" <?php if(date("m") > 6 && date("m") < 10){echo 'selected';} ?>>3분기</option>
											<option value="4" <?php if(date("m") > 9){echo 'selected';} ?>>4분기</option>
										</select>
									</td>
									<td style="text-align:right;">
										<img src="<?php echo $misc; ?>/img/dashboard/btn/excel_download.png" alt="" style="margin-right: 5%; cursor: pointer;" onclick="excel_export();">
									</td>
								</tr>
							</table>
						</td>
					</tr>
		<!-- 검색창 끝 -->
					<tr height="30px">
					</tr>
		<!-- 리스트 -->
					<tr>
						<td align="center" valign="bottom">
							<table class="base_table" width="100%" cellspacing="0" cellpadding="0">
								<tr>
									<td>

										<div class="parents_div">
											<div class="child_div sales" style="font-weight:bold; font-size:15px; color:blue;">
												매입
											</div>
											<div class="child_div2 purchase" style="font-weight:bold; font-size:15px; color:red;">
												매출
											</div>
										</div>
								    <div class="parents_div" height="100%">
									<?php
										for($i = 0; $i < 4; $i++){
								  ?>
								      <div class="child_div">
								        <table width="100%" height="100%" class="table_border">
								          <thead>
								            <colgroup>
								              <col width="5%"> <!-- 분기/월 -->
								              <col width="6%"> <!-- 구분 -->
								              <col width="18%"> <!-- 공급가액 -->
								              <col width="18%"> <!-- 세액 -->
								              <col width="18%"> <!-- 합계 -->
								              <col width="6%"> <!-- 구분 -->
								              <col width="9%"> <!-- 국세청전송건수 -->
								              <col width="9%"> <!-- 구분 -->
															<col width="9%"> <!-- 국세청전송건수 -->
								            </colgroup>
								          </thead>
													<tbody>

												<?php
													for($j = 0; $j < 6; $j++){
												?>

														<tr height="<?php if($j == 0){echo '10';}else{echo '20';} ?>"  <?php if($j == 0){echo 'bgcolor="f8f8f9"';} ?>>
													<?php
														if($j == 0){
													?>
															<td colspan="1" rowspan="6" style="font-weight: bold; text-align: center;" name="<?php echo 'quarter_rate_'.$i.'_0_0' ?>" id="<?php echo 'sales_quarter_rate_'.$i.'_0_0' ?>"></td>
													<?php
														}
													?>
															<td colspan="1" class="t_border <?php if($j != 5){ echo 't_b_border';}?>" align="center" name="<?php echo 'quarter_rate_'.$i.'_'.$j.'_1' ?>" id="<?php echo 'sales_quarter_rate_'.$i.'_'.$j.'_1' ?>"></td>
															<td colspan="1" class="t_border <?php if($j != 5){ echo 't_b_border';}?>" align="center" name="<?php echo 'quarter_rate_'.$i.'_'.$j.'_2' ?>" id="<?php echo 'sales_quarter_rate_'.$i.'_'.$j.'_2' ?>"></td>
															<td colspan="1" class="t_border <?php if($j != 5){ echo 't_b_border';}?>" align="center" name="<?php echo 'quarter_rate_'.$i.'_'.$j.'_3' ?>" id="<?php echo 'sales_quarter_rate_'.$i.'_'.$j.'_3' ?>"></td>
															<td colspan="1" class="t_border <?php if($j != 5){ echo 't_b_border';}?>" align="center" name="<?php echo 'quarter_rate_'.$i.'_'.$j.'_4' ?>" id="<?php echo 'sales_quarter_rate_'.$i.'_'.$j.'_4' ?>"></td>
													<?php
														if($j != 5){
													?>
															<td colspan="1" class="t_border <?php if($j != 5){ echo 't_b_border';}?>" align="center" name="<?php echo 'quarter_rate_'.$i.'_'.$j.'_5' ?>" id="<?php echo 'sales_quarter_rate_'.$i.'_'.$j.'_5' ?>"></td>
															<td colspan="1" class="t_border <?php if($j != 5){ echo 't_b_border';}?>" align="center" name="<?php echo 'quarter_rate_'.$i.'_'.$j.'_6' ?>" id="<?php echo 'sales_quarter_rate_'.$i.'_'.$j.'_6' ?>"></td>
															<td colspan="1" class="t_border <?php if($j != 5){ echo 't_b_border';}?>" align="center" name="<?php echo 'quarter_rate_'.$i.'_'.$j.'_7' ?>" id="<?php echo 'sales_quarter_rate_'.$i.'_'.$j.'_7' ?>"></td>
															<td colspan="1" class="t_border <?php if($j != 5){ echo 't_b_border';}?>" align="center" name="<?php echo 'quarter_rate_'.$i.'_'.$j.'_8' ?>" id="<?php echo 'sales_quarter_rate_'.$i.'_'.$j.'_8' ?>"></td>
													<?php
														}else{
													?>
															<td colspan="4" class="t_border <?php if($j != 5){ echo 't_b_border';}?>" align="center" name="<?php echo 'quarter_rate_'.$i.'_'.$j.'_5' ?>" id="<?php echo 'sales_quarter_rate_'.$i.'_'.$j.'_5' ?>"></td>
													<?php
														}
													?>
														</tr>

												<?php
													} //for j
												?>
													</tbody>
								        </table>
								      </div>

								      <div class="child_div2">
												<table width="100%" height="100%" class="table_border">
													<thead>
														<colgroup>
															<col width="7%"> <!-- 구분 -->
															<col width="25%"> <!-- 공급가액 -->
															<col width="25%"> <!-- 세액 -->
															<col width="25%"> <!-- 합계 -->
															<col width="7%"> <!-- 구분 -->
															<col width="11%"> <!-- 국세청전송건수 -->
														</colgroup>
													</thead>
													<tbody>
														<?php
															for($j = 0; $j < 6; $j++){
														?>

																<tr height="<?php if($j == 0){echo '10';}else{echo '20';} ?>"  <?php if($j == 0){echo 'bgcolor="f8f8f9"';} ?>>
															<?php
																if($j == 0){
															?>
																	<td colspan="1" rowspan="6" style="font-weight: bold; display: none;" name="<?php echo 'quarter_rate_'.$i ?>" id="<?php echo 'purchase_quarter_rate_'.$i.'_0_0' ?>"></td>
															<?php
																}
															?>
																	<td colspan="1" class="<?php if($j != 5){ echo 't_b_border';}?>" align="center" name="<?php echo 'quarter_rate_'.$i.'_'.$j.'_1' ?>" id="<?php echo 'purchase_quarter_rate_'.$i.'_'.$j.'_1' ?>"></td>
																	<td colspan="1" class="t_border <?php if($j != 5){ echo 't_b_border';}?>" align="center" name="<?php echo 'quarter_rate_'.$i.'_'.$j.'_2' ?>" id="<?php echo 'purchase_quarter_rate_'.$i.'_'.$j.'_2' ?>"></td>
																	<td colspan="1" class="t_border <?php if($j != 5){ echo 't_b_border';}?>" align="center" name="<?php echo 'quarter_rate_'.$i.'_'.$j.'_3' ?>" id="<?php echo 'purchase_quarter_rate_'.$i.'_'.$j.'_3' ?>"></td>
																	<td colspan="1" class="t_border <?php if($j != 5){ echo 't_b_border';}?>" align="center" name="<?php echo 'quarter_rate_'.$i.'_'.$j.'_4' ?>" id="<?php echo 'purchase_quarter_rate_'.$i.'_'.$j.'_4' ?>"></td>
															<?php
																if($j != 5){
															?>
																	<td colspan="1" class="t_border <?php if($j != 5){ echo 't_b_border';}?>" align="center" name="<?php echo 'quarter_rate_'.$i.'_'.$j.'_5' ?>" id="<?php echo 'purchase_quarter_rate_'.$i.'_'.$j.'_5' ?>"></td>
																	<td colspan="1" class="t_border <?php if($j != 5){ echo 't_b_border';}?>" align="center" name="<?php echo 'quarter_rate_'.$i.'_'.$j.'_6' ?>" id="<?php echo 'purchase_quarter_rate_'.$i.'_'.$j.'_6' ?>"></td>
															<?php
																}else{
															?>
																	<td colspan="2" class="t_border <?php if($j != 5){ echo 't_b_border';}?>" align="center" name="<?php echo 'quarter_rate_'.$i.'_'.$j.'_5' ?>" id="<?php echo 'purchase_quarter_rate_'.$i.'_'.$j.'_5' ?>"></td>
															<?php
																}
															?>
																</tr>

														<?php
															} //for j
														?>
													</tbody>
												</table>

								      </div>

									<?php
										} //for i
									?>
								    </div>
									</td>
								</tr>
							</table>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>

	<!-- excel export table -->
	<div class="excel_div" style="display:none;">
		<table class="excel_table">

		</table>
	</div>
<!--하단-->
<?php include $this->input->server('DOCUMENT_ROOT')."/include/sales_bottom.php"; ?>
<!--하단-->
<script>

// excel_table
	function excel_table(){
	// $(document).ready(function () {
		var excel_download_table = "";

		excel_download_table += '<tr><table width="100%" height="100%" class="table_border"><thead><colgroup><col width="4%"><col width="5%"><col width="8%"><col width="8%"><col width="8%"><col width="5%"><col width="6%"><col width="6%"><col width="6%"><col width="4%"><col width="5%"><col width="8%"><col width="8%"><col width="8%"><col width="5%"><col width="6%"></colgroup></thead><tbody><tr><td colspan="9" align="center" style="font-weight:bold; color:blue">매입</td><td></td><td colspan="6" align="center" style="font-weight:bold; color:red">매출</td></tr>';

		for(i = 0; i < 4; i++){
			for(j = 0; j < 6; j++){

				excel_download_table += '<tr>';

				if(j == 0){
					excel_download_table += '<td colspan="1" rowspan="6" style="font-weight: bold; text-align: center;" name="quarter_rate_'+i+'_0_0" id="sales_quarter_rate_'+i+'_0_0__2"></td>';
				}
					excel_download_table += '<td align="center" name="quarter_rate_'+i+'_'+j+'_1" id="sales_quarter_rate_'+i+'_'+j+'_1__2"></td>';
					excel_download_table += '<td align="center" name="quarter_rate_'+i+'_'+j+'_2" id="sales_quarter_rate_'+i+'_'+j+'_2__2"></td>';
					excel_download_table += '<td align="center" name="quarter_rate_'+i+'_'+j+'_3" id="sales_quarter_rate_'+i+'_'+j+'_3__2"></td>';
					excel_download_table += '<td align="center" name="quarter_rate_'+i+'_'+j+'_4" id="sales_quarter_rate_'+i+'_'+j+'_4__2"></td>';

				if(j != 5){
					excel_download_table += '<td align="center" name="quarter_rate_'+i+'_'+j+'_5" id="sales_quarter_rate_'+i+'_'+j+'_5__2"></td>';
					excel_download_table += '<td align="center" name="quarter_rate_'+i+'_'+j+'_6" id="sales_quarter_rate_'+i+'_'+j+'_6__2"></td>';
					excel_download_table += '<td align="center" name="quarter_rate_'+i+'_'+j+'_7" id="sales_quarter_rate_'+i+'_'+j+'_7__2"></td>';
					excel_download_table += '<td align="center" name="quarter_rate_'+i+'_'+j+'_8" id="sales_quarter_rate_'+i+'_'+j+'_8__2"></td>';
				}else{
					excel_download_table += '<td colspan="4" align="center" name="quarter_rate_'+i+'_'+j+'_5" id="sales_quarter_rate_'+i+'_'+j+'_5__2"></td>';
				}
				if(j == 0){
					excel_download_table += '<td colspan="1" rowspan="6" style="font-weight: bold; text-align: center;" name="quarter_rate_'+i+'" id="quarter_rate_'+i+'_0_9__2"></td>';
				}

				excel_download_table += '<td align="center" name="quarter_rate_'+i+'_'+j+'_1" id="purchase_quarter_rate_'+i+'_'+j+'_1__2"></td>';
				excel_download_table += '<td align="center" name="quarter_rate_'+i+'_'+j+'_2" id="purchase_quarter_rate_'+i+'_'+j+'_2__2"></td>';
				excel_download_table += '<td align="center" name="quarter_rate_'+i+'_'+j+'_3" id="purchase_quarter_rate_'+i+'_'+j+'_3__2"></td>';
				excel_download_table += '<td align="center" name="quarter_rate_'+i+'_'+j+'_4" id="purchase_quarter_rate_'+i+'_'+j+'_4__2"></td>';

			if(j != 5){
				excel_download_table += '<td align="center" name="quarter_rate_'+i+'_'+j+'_5" id="purchase_quarter_rate_'+i+'_'+j+'_5__2"></td>';
				excel_download_table += '<td align="center" name="quarter_rate_'+i+'_'+j+'_6" id="purchase_quarter_rate_'+i+'_'+j+'_6__2"></td>';
			}else{
				excel_download_table += '<td colspan="2" align="center" name="quarter_rate_'+i+'_'+j+'_5" id="purchase_quarter_rate_'+i+'_'+j+'_5__2"></td>';
			}

				excel_download_table +=  '</tr>';
			}
			excel_download_table +=  '<tr></tr>';
		}

		excel_download_table += '</tbody></table></tr>';

		$(".excel_table").append(excel_download_table);
		// console.log($(".excel_table").html());
	// });
	};


	function excel_export(){

		var date = $("#year_select").val() + '년 ' + $("#quarter_select").val() + '분기';
		if($("#dept").val() == 'IT'){
			var company = '두리안정보기술 ';
		}else if($("#dept").val() == 'ICT'){
			var company = '두리안정보통신기술 ';
		}else if($("#dept").val() == 'MG'){
			var company = '더망고 ';
		}
	  var title = company + date;

	  var tab_text = '<html xmlns:x="urn:schemas-microsoft-com:office:excel">';
	  tab_text = tab_text + '<head><meta http-equiv="content-type" content="application/vnd.ms-excel; charset=UTF-8">';
	  tab_text = tab_text + '<xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>'
	  tab_text = tab_text + '<x:Name>'+title+'</x:Name>';
	  tab_text = tab_text + '<x:WorksheetOptions><x:Panes></x:Panes></x:WorksheetOptions></x:ExcelWorksheet>';
	  tab_text = tab_text + '</x:ExcelWorksheets></x:ExcelWorkbook></xml></head><body>';
	  tab_text = tab_text + "<table border='1px'>";

	  var exportTable = $('.excel_table').clone();
		exportTable.find('td').css('font-size','15px');
		exportTable.find('.parents_div').prop('font-size','15px');
		exportTable.find('.child_div').prop('font-size','15px');
		exportTable.find('.child_div2').prop('font-size','15px');
		exportTable.find('input').each(function (index, elem) {
			$(elem).remove();
		});

	  tab_text = tab_text + exportTable.html();
	  tab_text = tab_text + '</table></body></html>';

	  var data_type = 'data:application/vnd.ms-excel';
	  var ua = window.navigator.userAgent;
	  var msie = ua.indexOf("MSIE ");
	  var fileName = title + '.xls';
	  //Explorer 환경에서 다운로드
	  if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./)) {
	    if (window.navigator.msSaveBlob) {
	      var blob = new Blob([tab_text], {
	        type: "application/csv;charset=utf-8;"
	      });
	      navigator.msSaveBlob(blob, fileName);
	    }
	  } else {
	    var blob2 = new Blob([tab_text], {
	      type: "application/csv;charset=utf-8;"
	    });
	    var filename = fileName;
	    var elem = window.document.createElement('a');
	    elem.href = window.URL.createObjectURL(blob2);
	    elem.download = filename;
	    document.body.appendChild(elem);
	    elem.click();
	    document.body.removeChild(elem);
	  }

	}

</script>
</body>
</html>
