<?php
	include $this->input->server('DOCUMENT_ROOT')."/include/base.php";
	include $this->input->server('DOCUMENT_ROOT')."/include/sales_top.php";
?>
<link rel="stylesheet" href="/misc/css/dashboard.css">
<link rel="stylesheet" href="/misc/css/bootstrap-datepicker.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/timepicker@1.13.18/jquery.timepicker.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" /> <!-- 조직도 생성 -->
<link rel="stylesheet" href="/misc/css/tech_schedule/proton/style.min.css" /> <!-- 조직도 생성 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script> <!-- 조직도 생성 -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.9/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.9/js/select2.min.js"></script>
<script type="text/javascript" src="/misc/js/bootstrap-datepicker.js"></script>
<script src="https://cdn.jsdelivr.net/npm/timepicker@1.13.18/jquery.timepicker.min.js"></script>
<script type="text/javascript" src="/misc/js/jquery.bpopup-0.1.1.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.0/moment.min.js"></script>


<style>
	.head_tbl{
		border-collapse:collapse;
		border:1px solid;
		border-color:#050505;
		font-size: 14px;
	}

	.head_tbl th{
		 height: 40px;
		 padding:0px 10px 0px 10px;
		 border:1px solid;
		 border-color:#050505;
	}

	.head_tbl td{
		 height: 40px;
		 padding:0px 10px 0px 10px;
		 border:1px solid;
		 border-color:#050505;
	}
	.autosize{
		width:95%;
		margin: 10px 10px 10px 0px;
		font-size: 14px;
		font-family:"Noto Sans KR", sans-serif !important;
	}

	.datepicker{
		z-index:11000 !important;
	}

	.thinput {
	  font-family:"Noto Sans KR", sans-serif !important;
	  border: 1px solid #DEDEDE !important;
	  border-radius: 20px !important;
	  opacity: 1 !important;
	  outline: none !important;
		font-size: 14px;
		width:100%;
		height:80%;
	}

	.select2-search__field {
		font-family:"Noto Sans KR", sans-serif !important;
		border: 1px solid #DEDEDE !important;
		outline: none !important;
		width:80px!important;
	}

</style>
<body>
<?php
	include $this->input->server('DOCUMENT_ROOT')."/include/sales_header.php";
?>
<div align="center">
<div class="dash1-1">
<table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0" class="dash_tbl1-1">
  <tr height="5%">
	  <td class="dash_title"><img src="<?php echo $misc;?>img/dashboard/title_meeting_minutes.png"/></td>
	</tr>
	<tr style="padding-bottom:30px;">
		<td align="center" valign="top">
		<form name="cform" id="cform" method="post" enctype="multipart/form-data">
			<input type="hidden" name="register" id="register" value="">
			<table width="1130" cellspacing="0" cellpadding="0" style="margin-top:50px;" class="head_tbl" >
				<colgroup>
					<col width="15%">
					<col width="35%">
					<col width="15%">
					<col width="35%">
				</colgroup>
				<thead>
					<tr>
						<th align="center" style="background-color:#e0e0e0;">
							제&nbsp;&nbsp;&nbsp;목
						</th>
						<th colspan="3">
							<input type="text" class="thinput" name="doc_title" id="doc_title" value="">
						</th>
					</tr>
					<tr>
						<th align="center" style="background-color:#e0e0e0;">일&nbsp;&nbsp;&nbsp;시</th>
						<th>
							<input type="text" class="thinput" name="start_day" id="start_day" value="" style="width:30%" maxlength="10" autocomplete="off" placeholder="날 짜"/>
							<input type="text" class="thinput" name="stime" id="stime" style="width:30%" maxlength="5" autocomplete="off" placeholder="시작시간"> ~
							<input type="text" class="thinput" name="etime" id="etime" style="width:30%" maxlength="5" autocomplete="off" placeholder="종료시간">
						</th>
						<th align="center" style="background-color:#e0e0e0;">장&nbsp;&nbsp;&nbsp;소</th>
						<th>
							<select class="thinput" name="place" id="place">
								<?php
								foreach ($place as $room) {
									echo "<option value='{$room->room_name}'>{$room->room_name}</option>";
								}
								 ?>
							</select>
						</th>
					</tr>
					<tr>
						<th align="center" style="background-color:#e0e0e0;">부&nbsp;&nbsp;&nbsp;서</th>
						<th>
							<select class="thinput" name="user_group" id="user_group">
								<option value="">선택없음</option>
								<option value="사업부장">사업부장</option>
								<!-- <option value="사업부서">사업부서</option>
								<option value="기술연구소">기술연구소</option>
								<option value="영업관리">영업관리</option>
								<option value="경영지원실">경영지원실</option> -->
								<?php
foreach ($user_group as $group) {
	echo "<option value='{$group->groupName}'>{$group->groupName}</option>";
}
								 ?>

							</select>
						</th>
						<th align="center" style="background-color:#e0e0e0;">참여자</th>
						<th>
							<select class="" name="participant[]" id="participant" multiple="multiple">
								<option value="">선택하세요</option>
								<?php
								foreach ($user as $us) {
									echo "<option value='{$us->user_id}'>{$us->user_name} {$us->user_duty}</option>";
								}
								 ?>

							</select>
						</th>
					</tr>
					<tr>
						<th colspan="4" align="center" style="background-color:#e0e0e0;">
							내&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;용
							<span style="float:right"><img src="<?php echo $misc;?>img/btn_add.jpg" style="cursor:pointer;" onclick="plus_content('first');"/></span>
						</th>
					<tr>
					<!-- <tr>
						<td colspan="4">

							<span style="float:right"><img src="<?php echo $misc;?>img/btn_add.jpg" style="cursor:pointer;" onclick="plus_content();"/></span>
						</td>
					</tr> -->
				</thead>
				<tbody id="content_tbl">
				<tr class="content_tr">
				<td>
					<textarea name="subtitle[]" rows="3" class="autosize" value="" style="resize:none;text-align:center;" onkeydown="y_size(this);" onkeyup="y_size(this);"></textarea>
				</td>
				<td colspan="3">
					<textarea name="contents[]" rows="3" class="autosize" style="resize:none;" onkeydown="y_size(this);" onkeyup="y_size(this);"></textarea>
					<span style="float:right; padding-top:10px;">
						<img src="<?php echo $misc;?>img/btn_del0.jpg" style="cursor:pointer;" onclick="del_content(this);"/><br>
						<img src="<?php echo $misc;?>img/btn_add.jpg" style="cursor:pointer;" onclick="plus_content(this);"/>
						<input type="hidden" name="tr_num[]" value="">
					</span>
				</td>
				</tr>
			</tbody>
			</table>
		</form>
		</td>
	</tr>
	<tr>
		<td height="60">
	</tr>
	<tr valign="top">
		<td align="center">
	<img src="<?php echo $misc;?>img/dashboard/btn/btn_add.png" style="cursor:pointer;" height="40" onclick="doc_submit('add');"/>
	<img src="<?php echo $misc;?>img/dashboard/btn/btn_save.png" style="cursor:pointer;" height="40" onclick="doc_submit('save');"/>
	<img src="<?php echo $misc;?>img/dashboard/btn/btn_cancel.png" style="cursor:pointer;" height="40" onclick="history.go(-1);"/>
		</td>
	</tr>
	<tr>
		<td height="60">
	</tr>
</table>
</div>
</div>
<?php include $this->input->server('DOCUMENT_ROOT')."/include/sales_bottom.php"; ?>
<script>
// 날짜 달력만들기
$('#start_day').datepicker({
	format: "yyyy-mm-dd",
	clearBtn : false

})

//시간 시계 만들기
$('#stime').timepicker({
	timeFormat:'H:i',
	'minTime':'08:00',
	'maxTime':'22:00',
	'scrollDefaultNow': true
}).on('changeTime',function() {
        var from_time = $("input[name='stime']").val();
				// var end_min = moment(from_time).add("30", "m");
				// var end_min = moment(end_min).format('HH:mm');
				// console.log(end_min);
        $('#etime').timepicker('option','minTime', from_time);//etime의 mintime을 스타트타임보다 작게 안되게 하고
        if ($('#etime').val() && $('#etime').val() < from_time) {
            $('#etime').timepicker('setTime', from_time);
//etime을 먼저 선택한 경우  etime시간이 stime시간보다 작은경우 etime시간 변경
        }
    });

$('#etime').timepicker({
	timeFormat:'H:i',
	'minTime':'08:00',
	'maxTime':'22:00'
});


$('#participant').select2({
	width:'100%',
	placeholder: '검색어 입력'
});

// 내용 추가 삭제하는거
function plus_content(td){
	// var td=$(td).closest('tr');
	var contents = '';
  contents += '<tr class="content_tr"><td><textarea name="subtitle[]" rows="3" class="autosize" style="resize:none;text-align:center;" onkeydown="y_size(this);" onkeyup="y_size(this);" value=""></textarea></td>';
contents += '<td colspan="3"><textarea name="contents[]" rows="3" class="autosize" style="resize:none;" onkeydown="y_size(this);" onkeyup="y_size(this);"></textarea>';
contents += '<span style="float:right; padding-top:10px;"><img src="<?php echo $misc;?>img/btn_del0.jpg" style="cursor:pointer;" onclick="del_content(this);"/><br><img src="<?php echo $misc;?>img/btn_add.jpg" style="cursor:pointer;" onclick="plus_content(this);"/><input type="hidden" name="tr_num[]" value=""></span>';
contents += '	</td></tr>';
if(td == "first"){

// $('.head_tbl tbody:first-child').append(contents);
var rowcount = $("#content_tbl tr").length;
console.log(rowcount);
if(rowcount == 0){
	$("#content_tbl").append(contents);
}else{
	$("#content_tbl tr:first").before(contents);

}
// $('.head_tbl tbody:first-child').append(contents);

}else{
var td=$(td).closest('tr');
td.after(contents);
}
$("#sidebar_left").height($("#main_contents").height());
$(".sidebar_sub_on").height($("#main_contents").height());
}

function del_content(td){
	$(td).closest('tr').remove();
	$("#sidebar_left").height($("#main_contents").height());
 $(".sidebar_sub_on").height($("#main_contents").height());
}

// $("textarea.autosize").on('keydown keyup', function () {
//   $(this).height(1).height( $(this).prop('scrollHeight')+12 );
// 	$("#sidebar_left").height($("#main_contents").height());
//  $(".sidebar_sub_on").height($("#main_contents").height());
// });

// 텍스트 에이리어 스크롤바 안생기고 늘어나게 하기
function y_size(area){
	$(area).height(1).height( $(area).prop('scrollHeight')+12 );
	$("#sidebar_left").height($("#main_contents").height());
 $(".sidebar_sub_on").height($("#main_contents").height());
}

// 등록 저장할때 서브밋하는거
function doc_submit(mode){
	if(mode == "add"){
		$("#register").val("y");
		if($("#doc_title").val()==""){
			alert("제목을 입력해주세요");
			$("#doc_title").focus();
			return false;
		}

		if($("#start_day").val()==""){
			alert("날짜를 선택해주세요");
			$("#start_day").focus();
			return false;
		}
	}else{
		$("#register").val("n");
	}

	$("#content_tbl tr").each(function(){
		var tr_index = $(this).index();
		$(this).find("input:last").val(tr_index);
	})
var act = "<?php echo site_url();?>/biz/meeting_minutes/mom_input_action";
$("#cform").attr('action', act);
$("#cform").submit();
}

</script>
</body>
</html>
