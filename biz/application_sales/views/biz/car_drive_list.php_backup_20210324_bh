<?php
  include $this->input->server('DOCUMENT_ROOT')."/include/base.php";
  include $this->input->server('DOCUMENT_ROOT')."/include/customer_top.php";
  // tech_doc_list 김수성
?>
<link rel="stylesheet" href="/misc/css/dashboard.css">
<script type="text/javascript" src="/misc/js/jquery.bpopup-0.1.1.min.js"></script>
<script language="javascript">
function GoSearch(){
  var searchkeyword = document.mform.searchkeyword.value;
  var searchkeyword = searchkeyword.trim();

//  if(searchkeyword == ""){
//    alert( "검색어를 입력해 주세요." );
//    return false;
//  }

  document.mform.action = "<?php echo site_url();?>/biz/durian_car/car_drive_list";
  document.mform.cur_page.value = "";
//  document.mform.search_keyword.value = searchkeyword;
  document.mform.submit();
}

//$(document).ready(function() {
//   $('li > ul').show();
//});
</script>
<body>
<?php
  include $this->input->server('DOCUMENT_ROOT')."/include/sales_header.php";
?>
<div align="center">
<div class="dash1-1">
<table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0" class="dash_tbl1-1">
<form name="mform" action="<?php echo site_url();?>/biz/durian_car/car_drive_list" method="get" onKeyDown="if(event.keyCode==13) return GoSearch();">
<input type="hidden" name="cur_page" value="<?php echo $cur_page; ?>">
<input type="hidden" name="seq" value="">
<input type="hidden" name="mode" value="">
<tbody height="100%">
<tr height="5%">
  <td class="dash_title"><img src="<?php echo $misc;?>img/dashboard/title_car_drive_list.png"/></td>
</tr>

<!-- 검색창 -->
<tr height="10%">
  <td align="left" valign="bottom">
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td width="16%"></td>
        <td>
          <select name="search1" id="search1" class="select2">
            <option value="001" <?php if($search1 == "001"){ echo "selected";}?>>차번</option>
            <option value="002" <?php if($search1 == "002"){ echo "selected";}?>>출발지</option>
            <option value="003" <?php if($search1 == "003"){ echo "selected";}?>>목적지</option>
            <option value="004" <?php if($search1 == "004"){ echo "selected";}?>>운행자</option>
            <option value="005" <?php if($search1 == "005"){ echo "selected";}?>>운행일</option>
          </select>
        <!-- </td>
        <td> -->
        <span>
          <input type="text" size="25" class="input2" name="searchkeyword" placeholder="검색하세요." value="<?php echo str_replace('"', '&uml;', $search_keyword );?>"/>
        </span>
        <!-- </td>
        <td> -->
        <span>
          <input type="image" style='cursor:hand; margin-bottom:8px;' onClick="return GoSearch();" src="<?php echo $misc;?>img/dashboard/btn/btn_search.png" width="20px" height="20px" align="middle" border="0" />
        </span>
        </td>
        <!-- <td>
        <table width="" border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td>
              <input  type="text" size="25" class="input2" name="searchkeyword" placeholder="검색하세요." value="<?php echo str_replace('"', '&uml;', $search_keyword );?>"/>
            </td>
            <td>
              <input type="image" style='cursor:hand' onClick="return GoSearch();" src="<?php echo $misc;?>img/dashboard/btn/btn_search.png" width="20px" height="20px" align="middle" border="0" />
            </td>
            </tr>
          </table>
        </td> -->
        </tr>
      </table>
  </td>
</tr>
<!-- 콘텐트시작 -->
<tr height="45%">
<td valign="top" style="padding:15px 0px 15px 0px">
    <table class="content_dash_tbl" align="center" width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
          <td align="center" valign="top">
            <tr>
              <td>
              <table width="100%" border="0" cellspacing="0" cellpadding="0">
                <colgroup>
                  <col width="15%">
                  <col width="3.5%">
                  <col width="10.5%">
                  <col width="10.5%">
                  <col width="10.5%">
                  <col width="7%">
                  <col width="7%">
                  <col width="5.6%">
                  <col width="7%">
                  <col width="8.4%">
                  <col width="15%">
                </colgroup>

                <tr class="t_top">
                  <th></th>
                  <th height="40" align="center">No.</th>
                  <th align="center">차종</th>
                  <th align="center">출발지</th>
                  <th align="center">목적지</th>
                  <th align="center">출발시km</th>
                  <th align="center">도착시km</th>
                  <th align="center">주행거리</th>
                  <th align="center">운행자</th>
                  <th align="center">운행일</th>
                  <th></th>
                </tr>

    <?php
      if ($count > 0) {
        $i = $count - $no_page_list * ( $cur_page - 1 );
        $icounter = 0;
        foreach ( $list_val as $item ) {
    ?>
                <tr onMouseOver="this.style.backgroundColor='#EAEAEA'" onMouseOut="this.style.backgroundColor='#fff'">
                  <td></td>
                  <td height="40" align="center"><?php echo $i;?></td>
                  <td align="center">
                    <a href="JavaScript:ViewBoard('<?php echo $item['seq'];?>')">
                      <?php echo $item['carname']." / ".$item['carnum'];?>
                    </a>
                  </td>
                  <td align="center">
                      <?php echo $item['d_point'];?>
                  </td>
                  <td align="center">
                      <?php echo $item['a_point'];?>
                  </td>
                  <td align="center">
                      <?php echo $item['d_km'];?>km
                  </td>
                  <td align="center">
                      <?php echo $item['a_km'];?>km
                  </td>
                  <td align="center">
                      <?php echo $item['a_km']-$item['d_km'];?>km
                  </td>
                  <td align="center">
                      <?php echo $item['driver'];?>
                  </td>
                  <td align="center">
                      <?php echo $item['drive_date'];?>
                  </td>
                  <td></td>
                </tr>
                <!-- <tr>
                  <td colspan="9" height="1" bgcolor="#e8e8e8"></td>
                </tr> -->
    <?php
          $i--;
          $icounter++;
        }
      } else {
    ?>
    <tr>
      <td width="100%" height="40" align="center" colspan="11">등록된 게시물이 없습니다.</td>
    </tr>

    <?php
      }
    ?>
              </table></td>
            </tr>
<script language="javascript">
function GoFirstPage (){
  document.mform.cur_page.value = 1;
  document.mform.submit();
}

function GoPrevPage (){
  var cur_start_page = <?php echo $cur_page;?>;

  document.mform.cur_page.value = Math.floor( ( cur_start_page - 11 ) / 10 ) * 10 + 1;
  document.mform.submit( );
}

function GoPage(nPage){
  document.mform.cur_page.value = nPage;
  document.mform.submit();
}

function GoNextPage (){
  var cur_start_page = <?php echo $cur_page;?>;

  document.mform.cur_page.value = Math.floor( ( cur_start_page + 9 ) / 10 ) * 10 + 1;
  document.mform.submit();
}

function GoLastPage (){
  var total_page = <?php echo $total_page;?>;
  //  alert(total_page);

  document.mform.cur_page.value = total_page;
  document.mform.submit();
}

function ViewBoard (seq){
  document.mform.action = "<?php echo site_url();?>/biz/durian_car/car_drive_view";
  document.mform.seq.value = seq;
  document.mform.mode.value = "view";

  document.mform.submit();
}
</script>
          </td>

      </tr>
   </table>
</td>
</tr>
<!-- 컨텐트 테이블 끝 -->
<!-- 페이징 버튼 시작 -->
<tr height="40%">
  <td align="left" valign="top">
    <table width="100%" cellspacing="0" cellpadding="0">
    <tr>
      <td width="19%">

        <tr height="20%">
          <td align="center" valign="top">
<?php if ($count > 0) {?>
<table width="400" border="0" cellspacing="0" cellpadding="0">
    <tr>
<?php
if ($cur_page > 10){
?>
      <td width="19"><a href="JavaScript:GoFirstPage()"><img src="<?php echo $misc;?>img/dashboard/btn/btn_first.png" width="20" height="20"/></a></td>
      <td width="2"></td>
      <td width="19"><a href="JavaScript:GoPrevPage()"><img src="<?php echo $misc;?>img/dashboard/btn/btn_left.png" width="20" height="20"/></a></td>
<?php
} else {
?>
<td width="19"></td>
      <td width="2"></td>
      <td width="19"></td>
<?php
}
?>
      <td align="center">
<?php
for  ( $i = $start_page; $i <= $end_page ; $i++ ){
if( $i == $end_page ) {
  $strSection = "";
} else {
  $strSection = "&nbsp;<span class=\"section\">&nbsp&nbsp</span>&nbsp;";
  // $strSection = "&nbsp;<span class=\"section\">|</span>&nbsp;";
}

if  ( $i == $cur_page ) {
  echo "<a href=\"JavaScript:GoPage( '".$i."' )\" class=\"alink\"><font color=\"#33ccff\">".$i."</font></a>".$strSection;
} else {
  echo "<a href=\"JavaScript:GoPage( '".$i."' )\" class=\"alink\">".$i."</a>".$strSection;
}
}
?></td>
      <?php
if   ( floor( ( $cur_page - 1 ) / 10 ) < floor( ( $total_page - 1 ) / 10 ) ){
?>
<!-- <td width="19"><a href="JavaScript:GoNextPage()"><img src="<?php echo $misc;?>img/dashboard/page_next.png" width="20" height="20"/></a></td> -->
      <td width="2"></td>
      <td width="19"><a href="JavaScript:GoNextPage()"><img src="<?php echo $misc;?>img/dashboard/btn/btn_right.png" width="20" height="20"/></a></td>
      <td width="19"><a href="JavaScript:GoLastPage()"><img src="<?php echo $misc;?>img/dashboard/btn/btn_last.png" width="20" height="20"/></a></td>
<?php
} else {
?>
<td width="19"></td>
      <td width="2"></td>
      <td width="19"></td>
<?php
}
?>


</tr>
</table>
<?php }?>
</td>
</tr>
</td>
</tr>

<tr>
  <td width="19%">
    <tr>
      <td height="10"></td>
    </tr>
<tr>
  <td align="center" colspan="8"><img src="<?php echo $misc;?>img/dashboard/btn/btn_write.png" width="90" height="35" style="cursor:pointer;" onClick="$('#car_drive_input').bPopup();"/></td>
</tr>
<tr>
  <td height="10"></td>
</tr>
</td>
</tr>
</table>
</td>
</tr>

      </tbody>
    </form>
</table>
  </div>
</div>

<?php include $this->input->server('DOCUMENT_ROOT')."/include/sales_bottom.php"; ?>

<!-- 차량운행일지 등록 모달 시작 -->
<div id="car_drive_input" style="display:none; position: absolute; background-color: white; width: auto; height: auto;">
  <form name="cform" id="cform" action="<?php echo site_url();?>/biz/durian_car/car_drive_input_action" method="post" enctype="multipart/form-data">
    <table width="100%" height="100%" style="padding:20px 18px;" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td colspan="4" align="middle" valign="top" style="padding-bottom:20px; font-weight:bold; font-size:17px;">차량운행일지</td>
      </tr>
      <tr>
        <th colspan="4" height="2"></th>
        <tr>
          <td colspan="2" align="left" valign="bottom" style="padding:0 8px 5px; font-weight:bold;">
            차량
          </td>
          <td colspan="2" align="left" valign="bottom" style="padding:0 8px 5px; font-weight:bold;">
            운행일
          </td>
        </tr>
        <tr>
          <td colspan="2" align="left" valign="top" style="padding:0px 8px 10px;">
            <select name="carname" id="carname"  class="input2" onChange="changekm();" style="width:185px; height:25px;">
              <?php foreach($car_list as $cl){ ?>
                <option value="<?php echo $cl->type."-".$cl->number; ?>"><?php echo $cl->type."(".$cl->number.")" ?></option>
              <?php } ?>
            </select>
          </td>
          <td colspan="2" align="left" valign="top" style="padding:0px 8px 10px;">
            <input type="date" id="drive_date" name="drive_date" value="" class="input2" style="width:185px; height:25px;">
          </td>
        </tr>
        <tr>
          <td colspan="2" align="left" valign="bottom" style="padding:0 8px 5px; font-weight:bold;">
            출발지
          </td>
          <td colspan="2" align="left" valign="bottom" style="padding:0 8px 5px; font-weight:bold;">
            목적지
          </td>
        </tr>
        <tr>
          <td colspan="2" align="left" valign="top" style="padding:0px 8px 10px;">
            <input name="d_point" id="d_point" class="input2" style="width:180px; height:25px;">
          </td>
          <td colspan="2" align="left" valign="top" style="padding:0px 8px 10px;">
            <input name="a_point" id="a_point" class="input2" style="width:180px; height:25px;">
          </td>
        </tr>
        <tr>
          <td colspan="2" align="left" valign="bottom" style="padding:0 8px 5px; font-weight:bold;">
            출발시간
          </td>
          <td colspan="2" align="left" valign="bottom" style="padding:0 8px 5px; font-weight:bold;">
            도착시간
          </td>
        </tr>
        <tr>
          <td colspan="2" align="left" valign="top" style="padding:0px 8px 10px;">
            <input type="time" name="d_time" id="d_time" class="input2" style="width:180px; height:25px;">
          </td>
          <td colspan="2" align="left" valign="top" style="padding:0px 8px 10px;">
            <input type="time" name="a_time" id="a_time" class="input2" style="width:180px; height:25px;">
          </td>
        </tr>
        <tr>
          <td colspan="2" align="left" valign="bottom" style="padding:0 8px 5px; font-weight:bold;">
            출발km
          </td>
          <td colspan="2" align="left" valign="bottom" style="padding:0 8px 5px; font-weight:bold;">
            도착시km
          </td>
        </tr>
        <tr>
          <td colspan="2" align="left" valign="top" style="padding:0px 8px 10px;">
            <input name="d_km" id="d_km" class="input2" style="width:180px; height:25px;" value="<?php echo $view_val['max_km'];?>" placeholder="km" readonly>
          </td>
          <td colspan="2" align="left" valign="top" style="padding:0px 8px 10px;">
            <input name="a_km" id="a_km" class="input2" style="width:180px; height:25px;" placeholder="km" onKeyup="this.value=this.value.replace(/[^0-9]/g,'');"/>
          </td>
        </tr>
        <tr>
          <td colspan="4" align="left" valign="bottom" style="padding:0 8px 5px; font-weight:bold;">
            운행목적
          </td>
        </tr>
        <tr>
          <td colspan="4" align="left" valign="top" style="padding:0px 8px 10px;">
            <input class="input2" name="drive_purpose" id="drive_purpose" style="width:380px; height:25px;"/>
          </td>
        </tr>
        <tr>
          <td colspan="2" align="left" valign="bottom" style="padding:0 8px 5px; font-weight:bold;">
            운전자
          </td>
          <td colspan="2" align="left" valign="bottom" style="padding:0 8px 5px; font-weight:bold;">
            등록자
          </td>
        </tr>
        <tr>
          <td colspan="2" align="left" valign="top" style="padding:0px 8px 10px;">
            <input name="driver" id="customer_manager" class="input2" style="width:180px; height:25px;"/>
          </td>
          <td colspan="2" align="left" valign="top" style="padding:0px 8px 10px;">
            <input type="text" name="writer" id="writer" class="input2" style="width:180px; height:25px;" value="<?php echo $name;?>" readonly/>
          </td>
        </tr>
        <tr>
          <td colspan="2" align="left" valign="bottom" style="padding:0 8px 5px; font-weight:bold;">
            주유비
          </td>
          <td colspan="2" align="left" valign="bottom" style="padding:0 8px 5px; font-weight:bold;">
            기타
          </td>
        </tr>
        <tr>
          <td colspan="2" align="left" valign="top" style="padding:0px 8px 10px;">
            <input name="oil" id="oil" class="input2" style="width:180px; height:25px;"/>
          </td>
          <td colspan="2" align="left" valign="top" style="padding:0px 8px 10px;">
            <input name="etc" id="etc" class="input2" style="width:180px; height:25px;"/>
          </td>
        </tr>
      </tr>
      <tr>
        <td colspan="4" align="center" style="padding-top:30px;">
          <!--지원내용 추가 버튼-->
          <img src="<?php echo $misc;?>img/dashboard/btn/btn_add.png" width="64" height="31" style="cursor:pointer; padding:0 5px;" onClick="cardrive_input();"/>

          <img src="<?php echo $misc;?>img/dashboard/btn/btn_cancel.png" width="64" height="31" style="cursor:pointer; padding:0 5px;" onClick="$('#car_drive_input').bPopup().close()" />
        </td>
      </tr>
    </table>
  </form>
</div>
<!-- 차량운행일지 등록 모달 끝  -->
<script>
function changekm(){
  var car_name = $('#carname').val();
  var car_num = car_name.split('-')[1];
  console.log(car_num);
  $.ajax({
    url : "<?php echo site_url(); ?>/biz/durian_car/check_km",
    type : "POST",
    dataType : "json",
    data : {
      car_num: car_num
    },
    success : function(data) {
      console.log(data.max_km);
      $('#d_km').val(data.max_km);
    }

});
}

function cardrive_input(){
  // var act = "<?php echo site_url();?>/biz/weekly_report/weekly_report_input_action";
  // $("#cform").attr('action', act);
  var arrive = $("#a_km").val();
  if(arrive == ''){
    alert("도착시km를 입력해주세요");
    return false;
  }

  $("#cform").submit();
}
</script>
</body>
</html>
