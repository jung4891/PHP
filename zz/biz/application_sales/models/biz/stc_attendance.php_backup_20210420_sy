<?php
header("Content-type: text/html; charset=utf-8");

class STC_Attendance extends CI_Model {

	function __construct() {

		parent::__construct();
    $this->id = $this->phpsession->get( 'id', 'stc' );
    $this->name = $this->phpsession->get( 'name', 'stc' );
    $this->lv = $this->phpsession->get( 'lv', 'stc' );
    $this->cnum = $this->phpsession->get( 'cnum', 'stc' );
    $this->seq = $this->phpsession->get( 'seq', 'stc' );
	}

	//사용자 가져오기
	function attendance_user(){
		// $sql = "SELECT u.user_name, u.user_duty,au.user_seq, am.card_num,am.date AS workdate,am.ws_time as wstime,am.wc_time as wctime,am.ws_ip_address,am.wc_ip_address,am.update_time,au.ws_time ,au.wc_time
		// FROM attendance_manual as am LEFT JOIN attendance_user AS au ON am.card_num = au.card_num LEFT JOIN user AS u ON au.user_seq = u.seq
		// WHERE u.user_id ='{$this->id}'  AND left(am.date,6) = '{$date}'";
		$sql = "SELECT u.user_name, u.user_duty,au.user_seq,am.seq ,am.card_num,am.date AS workdate,am.ws_time as wstime,am.wc_time as wctime,am.ws_ip_address,am.wc_ip_address,am.update_time,am.official_ws_time as ws_time ,am.official_wc_time as wc_time,am.status
		FROM attendance_manual as am LEFT JOIN attendance_user AS au ON am.card_num = au.card_num LEFT JOIN user AS u ON au.user_seq = u.seq
		WHERE u.user_id ='{$this->id}'";

		$query = $this->db->query($sql);

		if ($query->num_rows() <= 0) {
			return false;
		} else {
			return $query->result_array();
		}
	}

  function attendance_info() {
    $sql = "SELECT u.user_name, au.card_num, au.ws_time as designate_ws, au.wc_time as designate_wc from attendance_user au JOIN user u ON au.user_seq = u.seq where user_seq='{$this->seq}'";
    $query = $this->db->query($sql);
    if ($query->num_rows() <= 0) {
      return false;
    } else {
      return $query->row_array() ;
    }
  }

	function attendance_data($date,$card_num){
		$sql = "SELECT * from attendance_manual where card_num='{$card_num}' and date = {$date}";
		$query = $this->db->query($sql);
		// echo $sql."<br>";
		if($query->num_rows()<=0){
			return false;
		} else {
			return $query->row_array();
		}
	}

	function user_group() {
		$sql = "SELECT user_group from user where seq='{$this->seq}'";
    $query = $this->db->query($sql);
    if ($query->num_rows() <= 0) {
      return false;
    } else {
      return $query->row_array() ;
    }
	}

}
?>
