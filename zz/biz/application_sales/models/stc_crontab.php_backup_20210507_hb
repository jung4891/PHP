<?php
header("Content-type: text/html; charset=utf-8");

class STC_Crontab extends CI_Model {

	function __construct() {
		parent::__construct();
	}

	function holiday_count($locdate, $mode = 0) {
		$where = '';
		if($mode == 'attendance'){
			$where = " and dateName NOT IN ('임시공휴일', '대체공휴일')";
		}
		$sql = "select count(*) as cnt from holiday where locdate = {$locdate} {$where}";

		$query = $this->db->query($sql);

		return $query->row();
	}

	function holiday_insert($locdate, $dateName) {
		$sql = "insert into holiday (locdate, dateName, insert_date) values ('{$locdate}','{$dateName}',now())";

		$query = $this->db->query($sql);
	}

	function attendance_user() {
		$sql = "select card_num, ws_time, wc_time from attendance_user";

		$query = $this->db->query($sql);

		return $query->result_array();
	}

	function attendance_count($card_num, $date) {
		$sql = "select count(*) as cnt from attendance_manual where card_num = '{$card_num}' and date = '{$date}'";

		$query = $this->db->query($sql);

		return $query->row();
	}

	function annual($card_num, $date) {
		$sql = "SELECT eaa.*, u.seq AS user_seq, au.card_num
FROM electronic_approval_annual eaa
JOIN USER u ON eaa.user_id = u.user_id
JOIN attendance_user au ON u.seq = au.user_seq
WHERE annual_status = 'Y' AND card_num = '{$card_num}' AND '{$date}' BETWEEN annual_start_date AND annual_end_date";

		$query = $this->db->query($sql);

		if ($query->num_rows() <= 0) {
			return false;
		} else {
			return $query->row_array() ;
		}
	}

	function official_time($card_num) {
		$sql = "select ws_time, wc_time from attendance_user where card_num = '{$card_num}'";

		$query = $this->db->query($sql);

		return $query->row_array();
	}

	function attendance_input($data) {
		$this->db->insert('attendance_manual', $data);
	}
}
?>
